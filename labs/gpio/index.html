<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">

<title>
    
    Lab 2: GPIO Driver for the Switches and Buttons â€¢ ECEN 330
    
</title>

<!-- Bootstrap core CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

<!-- Custom styles for this template -->
<link rel="stylesheet" href=/ecen330/css/main.css>

<!-- <link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet"> -->
<!-- <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="https://use.typekit.net/jcn6ybb.css">

<!-- <link rel="icon" type="image/png" sizes="96x96" href=/ecen330/icon/favicon-96x96.png>
<link rel="icon" type="image/png" sizes="32x32" href=/ecen330/icon/favicon-32x32.png>
<link rel="icon" type="image/png" sizes="16x16" href=/ecen330/icon/favicon-16x16.png> -->

<script src="https://kit.fontawesome.com/d794f0229e.js" crossorigin="anonymous"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script type="text/javascript">
    $(function () {
        console.log("hi there");
        // this will get the full URL at the address bar
        var url = window.location.href;
        console.log(url);

        // passes on every "a" tag
        $(".list-group a").each(function () {
            console.log(this)
            // checks if its the same on the address bar
            if (url == (this.href)) {
                $(this).addClass("active");
            }
        });
    });        
</script>

</head>

<body>
  <div class="d-flex" id="wrapper">
    <div class="border-right sidebar-color" id="sidebar-wrapper">
    <div class="sidebar-sticky">
        <div class="sidebar-heading-big">
            <a href="/ecen330/">
                ECEN 330</a>
        </div>
        <div class="list-group list-group-flush sidebar-color">

            

            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <!-- <a href="https://slack.com/app_redirect?team=T01J887F8MU&channel=C01JF1N6TH8"
                class="list-item-normal list-group-item list-group-item-action sidebar-item" target="_blank"><i
                    class="fa fa-question-circle"></i>
                Slack</a> -->

        </div>

        <div class="sidebar-heading">Setup</div>
        <div class="list-group list-group-flush">
            
            <a href="/ecen330/setup/step-1/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                

                Setup Step #1

            </a>
            
            <a href="/ecen330/setup/linux/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                &emsp;

                Home Setup: Linux

            </a>
            
            <a href="/ecen330/setup/vm/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                &emsp;

                Home Setup: VM

            </a>
            
            <a href="/ecen330/setup/step-2/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                

                Setup Step #2

            </a>
            
        </div>

        
        <div class="sidebar-heading">Labs</div>
        <div class="list-group list-group-flush">
            
            <a href="/ecen330/labs/hello-world/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey">1</span>
                

                Hello World

            </a>
            
            <a href="/ecen330/labs/gpio/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey">2</span>
                

                GPIO Driver

            </a>
            
            <a href="/ecen330/labs/timer/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey">3</span>
                

                Timer Driver

            </a>
            
            <a href="/ecen330/labs/interrupts/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey">4</span>
                

                Interrupt Driver

            </a>
            
            <a href="/ecen330/labs/touchscreen/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey">5</span>
                

                Touchscreen Driver

            </a>
            
            <a href="/ecen330/labs/clock/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey">6</span>
                

                Clock

            </a>
            
            <a href="/ecen330/labs/tictactoe/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey">7</span>
                

                Tic Tac Toe

            </a>
            
            <a href="/ecen330/labs/tictactoe-m1/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey"></span>
                &emsp;

                M1: Minimax

            </a>
            
            <a href="/ecen330/labs/tictactoe-m2/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey"></span>
                &emsp;

                M2: Control

            </a>
            
            <a href="/ecen330/labs/missile-command/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey">8</span>
                

                Missile Command

            </a>
            
            <a href="/ecen330/labs/missile-command-m1/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey"></span>
                &emsp;

                M1: Missiles

            </a>
            
            <a href="/ecen330/labs/missile-command-m2/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey"></span>
                &emsp;

                M2: Game Control

            </a>
            
            <a href="/ecen330/labs/missile-command-m3/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey"></span>
                &emsp;

                M3: Plane & Stats

            </a>
            
            <a href="/ecen330/labs/project/"
                class="list-item-normal list-group-item list-group-item-action bg-light sidebar-item">
                <span class="badge badge-pill badge-dark-grey">9</span>
                

                Choose Your Own

            </a>
            
        </div>

        <div class="sidebar-heading">Documentation</div>
        <div class="list-group list-group-flush">
            
            <a href="/ecen330/documentation/development-tools/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                

                Development Tools

            </a>
            
            <a href="/ecen330/documentation/compiling/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                &emsp;

                Compiling and Running

            </a>
            
            <a href="/ecen330/documentation/cmake/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                &emsp;

                CMake

            </a>
            
            <a href="/ecen330/documentation/headers/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                &emsp;

                Header Files

            </a>
            
            <a href="/ecen330/documentation/submission/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                &emsp;

                Submitting Code

            </a>
            
            <a href="/ecen330/documentation/vscode/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                &emsp;

                Coding/Debugging Tips

            </a>
            
            <a href="/ecen330/documentation/devices/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                

                System Platform

            </a>
            
            <a href="/ecen330/documentation/graphics/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                &emsp;

                LCD Graphics

            </a>
            
            <a href="/ecen330/documentation/gpio/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                &emsp;

                GPIO

            </a>
            
            <a href="/ecen330/documentation/timer/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                &emsp;

                Interval Timer

            </a>
            
            <a href="/ecen330/documentation/intc/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                &emsp;

                Interrupt Controller

            </a>
            
            <a href="/ecen330/documentation/touchscreen/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                &emsp;

                Touchscreen

            </a>
            
        </div>

        <div class="sidebar-heading">Other</div>
        <div class="list-group list-group-flush">
            
            <a href="/ecen330/other/c-programming/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                

                'C Programming' Study Questions

            </a>
            
            <a href="/ecen330/other/coding-standard/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                

                Coding Standard

            </a>
            
            <a href="/ecen330/other/coding-state-machines/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                

                Coding State Machines

            </a>
            
            <a href="/ecen330/other/suggestions/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                

                Suggestions

            </a>
            
            <a href="/ecen330/other/simon/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                

                Old Lab: Simon

            </a>
            
            <a href="/ecen330/other/wam/"
                class="list-item-narrow list-group-item list-group-item-action bg-light sidebar-item">
                

                Old Lab: Whack-a-Mole

            </a>
            
        </div>
    </div>
</div>

    <!-- Page Content -->
    <div id="page-content-wrapper">

      <nav class="navbar sticky-top navbar-expand-lg border-bottom">
        <button class="btn btn-brand" id="menu-toggle">
          <i class="fas fa-bars"></i>
        </button>

        <a href="" class="navbar-brand mb-0 h1 page-title-bar text-center mx-auto" id="page-title-bar"></a>

        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link btn btn-brand suggest-edits" target="_blank" rel="noopener noreferrer"
              href="https://piazza.com/byu/fall2023/ecen330"><i class="far fa-question-circle"></i> Piazza</a>
          </li>

          <li class="nav-item">
            <a class="nav-link btn btn-brand suggest-edits" target="_blank" rel="noopener noreferrer"
              href="https://github.com/byu-cpe/ecen330/issues/new?labels=website&title=Updates to Lab 2: GPIO Driver for the Switches and Buttons page"><i
                class="fab fa-github"></i> Suggest
              Edits</a>
          </li>
        </ul>
      </nav>

      <div class="container">
        

        <article class="page lab">
    <h1 class="page-title" id="page-title">
        Lab 2: GPIO Driver for the Switches and Buttons
        
    </h1>

    <div class="page-content">
        
        <div class="lab-toc col-md-6 col-lg-5 bg-light">
            <h4>Table of Contents</h4>
            <ul>
  <li><a href="#overview">Overview</a>
    <ul>
      <li><a href="#objectives">Objectives</a></li>
    </ul>
  </li>
  <li><a href="#preliminary">Preliminary</a></li>
  <li><a href="#implementation">Implementation</a>
    <ul>
      <li><a href="#requirements">Requirements</a></li>
      <li><a href="#files">Files</a></li>
      <li><a href="#other-notes">Other Notes</a></li>
    </ul>
  </li>
  <li><a href="#submission">Submission</a>
    <ul>
      <li><a href="#grade-breakdown">Grade Breakdown</a></li>
    </ul>
  </li>
</ul>

        </div>
        

        

        <h2 id="overview">Overview</h2>
<p>In this lab you will write a driver for the GPIO (general purpose input/output) hardware.  GPIO hardware allows the processor to interact with the input and output pins on the chip.  For this lab, the pins we are interested in are those connected to the slide switches and push buttons.  Once you have written your driver, you will be able to easily read button and switch values, and you will build a small test application to verify that your driver is working correct.</p>

<!-- One you have completed the driver software, you will create test programs to verify that your driver code works correctly. -->

<iframe width="560" height="315" allow="fullscreen" src="https://www.youtube.com/embed/PaIXUnRUg-4"> </iframe>

<iframe width="560" height="315" allow="fullscreen" src="https://www.youtube.com/embed/QYQlwwn_CJs"> </iframe>

<h3 id="objectives">Objectives</h3>
<ul>
  <li>Learn about how software interfaces with hardware devices.</li>
  <li>Gain experience writing driver code that interacts with hardware registers.</li>
  <li>Gain experience reading and understanding commercial documentation.
  <!-- - Understand how the GPIO IP block functions and write low-level code to communicate with it (instead of using the functions provided by *xgpio.h*). -->
  <!-- - Learn how to write low-level software to interface with buttons and switches. -->
  <!-- - Write reusable code that you may use in later labs. --></li>
  <li>Write test code that demonstrates the correctness of your driver.</li>
  <li>Practice applying the class coding standard.
  <!-- - Gain additional practice with the graphic library and the LCD. --></li>
</ul>

<h2 id="preliminary">Preliminary</h2>

<ol>
  <li>
    <p>Read about the <a href="/ecen330/documentation/devices/#programming-stack">Programming Stack</a>.</p>
  </li>
  <li>
    <p>When using programmable processors such as microprocessors, etc., we access low-level hardware via registers. See the <a href="/ecen330/documentation/gpio/">GPIO and Registers page</a> to understand how you will access the GPIO hardware.</p>
  </li>
  <li><strong>Terminology</strong>. Learn about some new terminology (reviewed in class):
    <ul>
      <li><a href="https://en.wikipedia.org/wiki/Memory_map">memory map</a></li>
      <li><a href="https://en.wikipedia.org/wiki/Address_bus">address bus</a></li>
      <li>data bus</li>
      <li>IP</li>
      <li>Register</li>
    </ul>
  </li>
  <li>
    <p><strong>Review header files</strong>. The <a href="https://github.com/byu-cpe/ecen330_student/blob/main/drivers/buttons.h">buttons.h</a> and <a href="https://github.com/byu-cpe/ecen330_student/blob/main/drivers/switches.h">switches.h</a> files which are provided in your repository.  These header files define the interface to your driver.</p>
  </li>
  <li>
    <p><strong>Including header files</strong>. Review the page about <a href="/ecen330/documentation/headers/">header files</a>.</p>
  </li>
  <li><strong>Compiling</strong>.  In this lab you will first write driver code, and then write a test application.
    <ul>
      <li>Read the page about <a href="/ecen330/documentation/cmake/">CMake files</a>.</li>
      <li>
        <p>The <em>driver</em> code will be re-used in later labs, so it will be compiled into a <em>library</em> that can be used by multiple applications. This library, called <em>buttons_switches</em>, will be located in the <a href="https://github.com/byu-cpe/ecen330_student/tree/main/drivers">drivers</a> directory.  You are already given a <a href="https://github.com/byu-cpe/ecen330_student/blob/main/drivers/CMakeLists.txt">CMakeLists.txt</a> file in this directory that will compile your <em>buttons.c</em> and <em>switches.c</em> code into the â€˜â€˜buttons_switchesâ€™â€™ library.</p>
      </li>
      <li>
        <p>The <em>application</em> code will be a simple test program to ensure your drivers are working correctly.  The test application will be placed in your <a href="https://github.com/byu-cpe/ecen330_student/tree/main/lab2_gpio">lab2</a> directory, where you have already been provided a <a href="https://github.com/byu-cpe/ecen330_student/blob/main/lab2_gpio/CMakeLists.txt">CMakeLists.txt</a> that will compile the Lab 2 executable.  You will see that it is almost the same as Lab 1 file, except that line 2 also includes the <em>buttons_switches</em> library.</p>
      </li>
      <li>The only changes you need to make for this lab is to instruct the top-level <a href="https://github.com/byu-cpe/ecen330_student/blob/main/CMakeLists.txt">CMakeLists.txt</a> file to enter both of these directories and process those CMakeLists.txt files.  Add  <code class="language-plaintext highlighter-rouge">add_subdirectory(lab2_gpio)</code> and <code class="language-plaintext highlighter-rouge">add_subdirectory(drivers)</code> statements to the top-level CMakeLists.txt, after the <code class="language-plaintext highlighter-rouge">add_subdirectory(lab1_helloworld)</code> statement.</li>
    </ul>
  </li>
</ol>

<h2 id="implementation">Implementation</h2>

<h3 id="requirements">Requirements</h3>

<ol>
  <li>
    <p><strong>Switches driver</strong>.  Write a driver for the slide switches.  This driver will be located in <em>drivers/switches.c</em> (you will need to create this file) and will implement the functions in <a href="https://github.com/byu-cpe/ecen330_student/blob/main/drivers/switches.h">switches.h</a>.</p>
  </li>
  <li>
    <p><strong>Buttons driver</strong>. Write a driver for the push buttons.  This driver will be located in <em>drivers/buttons.c</em> (you will need to create this file) and will implement the functions in <a href="https://github.com/byu-cpe/ecen330_student/blob/main/drivers/buttons.h">buttons.h</a>.</p>
  </li>
  <li>
    <p><strong>Test applications</strong>.  Create test functions for your two drivers.  The provided <a href="https://github.com/byu-cpe/ecen330_student/blob/main/lab2_gpio/main.c">main.c</a> calls the <code class="language-plaintext highlighter-rouge">gpioTest_buttons()</code> and <code class="language-plaintext highlighter-rouge">gpioTest_switches()</code> functions.  Write both of these functions in <em>lab2_gpio/gpioTest.c</em> (you will need to create this file).</p>
    <ul>
      <li><strong>Switches test:</strong>
        <ul>
          <li>The switch test program is shown in a video above.  It turns on LEDs corresponding to the switches that are in the UP position.</li>
          <li>The test will end once all four switches are UP.</li>
        </ul>
      </li>
      <li><strong>Buttons test:</strong>
        <ul>
          <li>The button test program is also shown in a video above. It will draw colored squares to the LCD dependent on which button is pressed.</li>
          <li>The test will end when all four buttons are pressed simultaneously.  (On the emulator, you can press multiple buttons at once using the SHIFT key.)</li>
          <li>You must only draw the rectangle once for each button press and erase it once for each button release. It is okay if there is some button bouncing but continuously drawing or erasing rectangle in a loop is not allowed.</li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<h3 id="files">Files</h3>
<ul>
  <li>Place your driver code in <em>buttons.c</em> and <em>switches.c</em>, located in the <a href="">drivers</a> directory.</li>
  <li>Place your test application code in <em>gpioTest.c</em> in the <a href="">lab2_gpio</a> directory.</li>
  <li>Do not modify <em>main.c</em> and do not modify any <em>header files</em>.  You can write additional helper functions beyond those defined in the <em>.h</em> file, but the helper functions should be declared and defined in your <em>.c</em> files (remember to declare them static).</li>
</ul>

<h3 id="other-notes">Other Notes</h3>
<ul>
  <li>Remember to follow the <a href="/ecen330/other/coding-standard/">coding standard</a>.</li>
  <li>You are provided a driver to control the LEDs. See <a href="https://github.com/byu-cpe/ecen330_student/blob/main/include/leds.h">leds.h</a>.  Include this header using <code class="language-plaintext highlighter-rouge">#include "leds.h"</code>.</li>
  <li>You should write helper functions for accessing device registers.  For example, <em>buttons.c</em> and <em>switches.c</em> could both contain:
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">readRegister</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">offset</span><span class="p">);</span>
  <span class="k">static</span> <span class="kt">void</span> <span class="nf">writeRegister</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">value</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="submission">Submission</h2>

<p>For each lab, you will follow the <a href="/ecen330/documentation/submission/">instructions on submitting source code</a> to submit your code.</p>

<h3 id="grade-breakdown">Grade Breakdown</h3>
<ul>
  <li>80% Functionality. If your code works well and shows no bugs, you should get the full amount.</li>
  <li>20% Code quality and adherence to the coding standard. You are allowed 10 freebies for this lab.</li>
</ul>


    </div>
</article>
      </div>
    </div>
    <!-- /#page-content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <!-- Bootstrap core JavaScript -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
<script src=/ecen330/js/jquery.visible.min.js></script>

<!-- Menu Toggle Script -->
<script>
    $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });

    var prevVisible = $('#page-title').visible();

    $(window).scroll(function () {
        currentVisible = $('#page-title').visible()
        if (prevVisible && !currentVisible) {
            console.log("Do something!");
            $("#page-title-bar").html($('#page-title').text());
        }

        if (!prevVisible && currentVisible) {
            $("#page-title-bar").html("")
        }

        prevVisible = currentVisible;
    });

</script>

</body>

</html>
